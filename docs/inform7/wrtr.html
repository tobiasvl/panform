<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Writer</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<ul><li><a href="../index.html">Panform</a></li>
<li><a href="index.html"><span class="selectedlink">inform7</span></a></li>
<li><a href="../ifm.html">IFM</a></li>
<li><a href="../iwfm.html">IWFM</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/tobiasvl/inform.md"><img src="../docs-assets/github.png" height=15> GitHub</a></li>
</ul><h2>Related projects</h2><ul>
<li><a href="https://ganelson.github.io/inform/">Inform</a></li>
<li><a href="https://ganelson.github.io/inweb/">Inweb</a></li>
</ul>
		</nav>
		<main role="main">
		<!-- Weave of 'Writer' generated by inweb -->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Panform</a></li><li><a href="index.html">inform7</a></li><li><b>Writer</b></li></ul></div>
<p class="purpose">A Pandoc writer.</p>

<ul class="toc"><li><a href="wrtr.html#SP1">&#167;1. Foo</a></li><li><a href="wrtr.html#SP6">&#167;6. Strings</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Foo.</b></p>

<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. </b>First, we avoid some boilerplate using the <a href="https://pandoc.org/lua-filters.html#module-pandoc.scaffolding" class="external">scaffolding</a> module.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="identifier-syntax">Writer</span><span class="plain-syntax"> = </span><span class="identifier-syntax">pandoc</span><span class="plain-syntax">.</span><span class="identifier-syntax">scaffolding</span><span class="plain-syntax">.</span><span class="identifier-syntax">Writer</span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. </b>Then we detect whether we are writing an Inform 7 story or extension.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="identifier-syntax">for</span><span class="plain-syntax"> </span><span class="identifier-syntax">_</span><span class="plain-syntax">, </span><span class="identifier-syntax">i</span><span class="plain-syntax"> </span><span class="identifier-syntax">in</span><span class="plain-syntax"> </span><span class="identifier-syntax">ipairs</span><span class="plain-syntax">(</span><span class="identifier-syntax">PANDOC_STATE</span><span class="plain-syntax">.</span><span class="identifier-syntax">input_files</span><span class="plain-syntax">) </span><span class="identifier-syntax">do</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">ext</span><span class="plain-syntax"> = </span><span class="identifier-syntax">pandoc</span><span class="plain-syntax">.</span><span class="identifier-syntax">List</span><span class="plain-syntax">(</span><span class="identifier-syntax">i</span><span class="plain-syntax">:</span><span class="identifier-syntax">gmatch</span><span class="plain-syntax"> </span><span class="string-syntax">"[^%.]+"</span><span class="plain-syntax">):</span><span class="identifier-syntax">at</span><span class="plain-syntax">(-2)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">ext</span><span class="plain-syntax"> == </span><span class="string-syntax">"ni"</span><span class="plain-syntax"> </span><span class="identifier-syntax">or</span><span class="plain-syntax"> </span><span class="identifier-syntax">ext</span><span class="plain-syntax"> == </span><span class="string-syntax">"i7"</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span><span class="plain-syntax"> </span><span class="identifier-syntax">i7_story</span><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span><span class="plain-syntax"> </span><span class="identifier-syntax">end</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">ext</span><span class="plain-syntax"> == </span><span class="string-syntax">"i7x"</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span><span class="plain-syntax"> </span><span class="identifier-syntax">i7_ext</span><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span><span class="plain-syntax"> </span><span class="identifier-syntax">end</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Extensions</span><span class="plain-syntax"> = {</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">smart</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">mark</span><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">alert</span><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span><span class="plain-syntax">,</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">lists_without_preceding_blankline</span><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span><span class="plain-syntax">,</span>
<span class="plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. </b>We keep track of whether we are inside a quote, to handle bracket syntax.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">insidequote</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. </b>Then we come to the parsing.
</p>

<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. Strings.</b>Text is just text, but if it contains unbalanced quotes, we toggle the insidequote state.
</p>

<pre class="displayed-code all-displayed-code code-font">
<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inline</span><span class="plain-syntax">.</span><span class="identifier-syntax">Str</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">str</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">if</span><span class="plain-syntax"> (</span><span class="identifier-syntax">str</span><span class="plain-syntax">.</span><span class="identifier-syntax">text</span><span class="plain-syntax">:</span><span class="identifier-syntax">find</span><span class="plain-syntax">(</span><span class="string-syntax">"^\""</span><span class="plain-syntax">) </span><span class="identifier-syntax">or</span><span class="plain-syntax"> </span><span class="identifier-syntax">str</span><span class="plain-syntax">.</span><span class="identifier-syntax">text</span><span class="plain-syntax">:</span><span class="identifier-syntax">find</span><span class="plain-syntax">(</span><span class="string-syntax">"\"$"</span><span class="plain-syntax">)) </span><span class="identifier-syntax">and</span><span class="plain-syntax"> </span><span class="identifier-syntax">not</span><span class="plain-syntax"> </span><span class="identifier-syntax">str</span><span class="plain-syntax">.</span><span class="identifier-syntax">text</span><span class="plain-syntax">:</span><span class="identifier-syntax">find</span><span class="plain-syntax">(</span><span class="string-syntax">"^\"[^\"]*\"$"</span><span class="plain-syntax">) </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">insidequote</span><span class="plain-syntax"> = </span><span class="identifier-syntax">not</span><span class="plain-syntax"> </span><span class="identifier-syntax">insidequote</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">end</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">str</span><span class="plain-syntax">.</span><span class="identifier-syntax">text</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inline</span><span class="plain-syntax">.</span><span class="identifier-syntax">Quoted</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">str</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">insidequote</span><span class="plain-syntax"> = </span><span class="identifier-syntax">true</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">result</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inlines</span><span class="plain-syntax">(</span><span class="identifier-syntax">str</span><span class="plain-syntax">.</span><span class="identifier-syntax">content</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">insidequote</span><span class="plain-syntax"> = </span><span class="identifier-syntax">false</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="string-syntax">"\""</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">result</span><span class="plain-syntax"> .. </span><span class="string-syntax">"\""</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inline</span><span class="plain-syntax">.</span><span class="identifier-syntax">Space</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">str</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="string-syntax">" "</span>
<span class="identifier-syntax">end</span>

<span class="comment-syntax"> TODO This probably doesn't work</span>
<span class="comment-syntax"> Writer.Inline.SoftBreak = function(str)</span>
<span class="comment-syntax"> 	return "\n\t"</span>
<span class="comment-syntax"> end</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inline</span><span class="plain-syntax">.</span><span class="identifier-syntax">SoftBreak</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">str</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="string-syntax">"\n"</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inline</span><span class="plain-syntax">.</span><span class="identifier-syntax">Code</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">code</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">insidequote</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="string-syntax">"["</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">code</span><span class="plain-syntax">.</span><span class="identifier-syntax">text</span><span class="plain-syntax"> .. </span><span class="string-syntax">"]"</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">else</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="string-syntax">"(- "</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">code</span><span class="plain-syntax">.</span><span class="identifier-syntax">text</span><span class="plain-syntax"> .. </span><span class="string-syntax">" -)"</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">end</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inline</span><span class="plain-syntax">.</span><span class="identifier-syntax">Strikeout</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">strike</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="string-syntax">"["</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inlines</span><span class="plain-syntax">(</span><span class="identifier-syntax">strike</span><span class="plain-syntax">.</span><span class="identifier-syntax">content</span><span class="plain-syntax">) .. </span><span class="string-syntax">"]"</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Block</span><span class="plain-syntax">.</span><span class="identifier-syntax">BlockQuote</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">bq</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="string-syntax">"[\n"</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Blocks</span><span class="plain-syntax">(</span><span class="identifier-syntax">bq</span><span class="plain-syntax">.</span><span class="identifier-syntax">content</span><span class="plain-syntax">) .. </span><span class="string-syntax">"\n]"</span>
<span class="identifier-syntax">end</span>

<span class="comment-syntax"> TODO indent each line</span>
<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Block</span><span class="plain-syntax">.</span><span class="identifier-syntax">CodeBlock</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">code</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">after</span><span class="plain-syntax"> = </span><span class="string-syntax">""</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">code</span><span class="plain-syntax">.</span><span class="identifier-syntax">attr</span><span class="plain-syntax">.</span><span class="identifier-syntax">classes</span><span class="plain-syntax">[1] == </span><span class="string-syntax">"preform"</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">after</span><span class="plain-syntax"> = </span><span class="string-syntax">" in the Preform grammar"</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">end</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="string-syntax">"Include (-\n"</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">code</span><span class="plain-syntax">.</span><span class="identifier-syntax">text</span><span class="plain-syntax"> .. </span><span class="string-syntax">"\n-)"</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">after</span><span class="plain-syntax"> .. </span><span class="string-syntax">"."</span>
<span class="identifier-syntax">end</span>

<span class="comment-syntax"> We override this to handle special cases with lists</span>
<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Blocks</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">blocks</span><span class="plain-syntax">, </span><span class="identifier-syntax">sep</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">sep</span><span class="plain-syntax"> = </span><span class="identifier-syntax">sep</span><span class="plain-syntax"> </span><span class="identifier-syntax">or</span><span class="plain-syntax"> </span><span class="identifier-syntax">pandoc</span><span class="plain-syntax">.</span><span class="identifier-syntax">layout</span><span class="plain-syntax">.</span><span class="identifier-syntax">blankline</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">result</span><span class="plain-syntax"> = </span><span class="string-syntax">""</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">for</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax">, </span><span class="identifier-syntax">block</span><span class="plain-syntax"> </span><span class="identifier-syntax">in</span><span class="plain-syntax"> </span><span class="identifier-syntax">ipairs</span><span class="plain-syntax">(</span><span class="identifier-syntax">blocks</span><span class="plain-syntax">) </span><span class="identifier-syntax">do</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">sep_foo</span><span class="plain-syntax"> = </span><span class="identifier-syntax">sep</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax"> == #</span><span class="identifier-syntax">blocks</span><span class="plain-syntax"> </span><span class="identifier-syntax">or</span><span class="plain-syntax"> ((</span><span class="identifier-syntax">block</span><span class="plain-syntax">.</span><span class="identifier-syntax">tag</span><span class="plain-syntax"> == </span><span class="string-syntax">"Para"</span><span class="plain-syntax"> </span><span class="identifier-syntax">or</span><span class="plain-syntax"> </span><span class="identifier-syntax">block</span><span class="plain-syntax">.</span><span class="identifier-syntax">tag</span><span class="plain-syntax"> == </span><span class="string-syntax">"Plain"</span><span class="plain-syntax">) </span><span class="identifier-syntax">and</span><span class="plain-syntax"> </span><span class="identifier-syntax">blocks</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">+1] </span><span class="identifier-syntax">and</span><span class="plain-syntax"> (</span><span class="identifier-syntax">blocks</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">+1].</span><span class="identifier-syntax">tag</span><span class="plain-syntax"> == </span><span class="string-syntax">"BulletList"</span><span class="plain-syntax"> </span><span class="identifier-syntax">or</span><span class="plain-syntax"> </span><span class="identifier-syntax">blocks</span><span class="plain-syntax">[</span><span class="identifier-syntax">i</span><span class="plain-syntax">+1].</span><span class="identifier-syntax">tag</span><span class="plain-syntax"> == </span><span class="string-syntax">"OrderedList"</span><span class="plain-syntax">)) </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">sep_foo</span><span class="plain-syntax"> = </span><span class="string-syntax">"\n"</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">end</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">result</span><span class="plain-syntax"> = </span><span class="identifier-syntax">result</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Block</span><span class="plain-syntax">(</span><span class="identifier-syntax">block</span><span class="plain-syntax">) .. </span><span class="identifier-syntax">sep_foo</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">end</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">result</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Block</span><span class="plain-syntax">.</span><span class="identifier-syntax">Para</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">para</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="comment-syntax">return Writer.Inlines(para.content)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> {</span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inlines</span><span class="plain-syntax">(</span><span class="identifier-syntax">para</span><span class="plain-syntax">.</span><span class="identifier-syntax">content</span><span class="plain-syntax">)}</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">h1</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Block</span><span class="plain-syntax">.</span><span class="identifier-syntax">Header</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">h</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="comment-syntax"> Very Bad People Choose Sin</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">levels</span><span class="plain-syntax"> = {</span>
<span class="plain-syntax">        </span><span class="string-syntax">"Volume"</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><span class="string-syntax">"Book"</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><span class="string-syntax">"Part"</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><span class="string-syntax">"Chapter"</span><span class="plain-syntax">,</span>
<span class="plain-syntax">        </span><span class="string-syntax">"Section"</span>
<span class="plain-syntax">    }</span>

<span class="plain-syntax">    </span><span class="identifier-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">h</span><span class="plain-syntax">.</span><span class="identifier-syntax">level</span><span class="plain-syntax"> == </span><span class="constant-syntax">1</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">h1</span><span class="plain-syntax"> = </span><span class="identifier-syntax">h1</span><span class="plain-syntax"> + </span><span class="constant-syntax">1</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">i7_story</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">h1</span><span class="plain-syntax"> == </span><span class="constant-syntax">1</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">                </span><span class="comment-syntax"> TODO If title is not wrapped in quotes</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="string-syntax">"\""</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">pandoc</span><span class="plain-syntax">.</span><span class="identifier-syntax">utils</span><span class="plain-syntax">.</span><span class="identifier-syntax">stringify</span><span class="plain-syntax">(</span><span class="identifier-syntax">h</span><span class="plain-syntax">.</span><span class="identifier-syntax">content</span><span class="plain-syntax">) .. </span><span class="string-syntax">"\""</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">else</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">error</span><span class="plain-syntax">(</span><span class="string-syntax">"Only one top-level heading allowed in Inform 7 story files (it should be used for the story title and author)."</span><span class="plain-syntax">)</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">end</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">elseif</span><span class="plain-syntax"> </span><span class="identifier-syntax">i7_ext</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">if</span><span class="plain-syntax"> </span><span class="identifier-syntax">h1</span><span class="plain-syntax"> == </span><span class="constant-syntax">1</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inlines</span><span class="plain-syntax">(</span><span class="identifier-syntax">h</span><span class="plain-syntax">.</span><span class="identifier-syntax">content</span><span class="plain-syntax">) .. </span><span class="string-syntax">" begins here."</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">elseif</span><span class="plain-syntax"> </span><span class="identifier-syntax">h1</span><span class="plain-syntax"> == </span><span class="constant-syntax">1</span><span class="plain-syntax"> </span><span class="identifier-syntax">then</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">string</span><span class="plain-syntax">.</span><span class="identifier-syntax">rep</span><span class="plain-syntax">(</span><span class="string-syntax">"-"</span><span class="plain-syntax">, </span><span class="constant-syntax">4</span><span class="plain-syntax">) ..</span><span class="string-syntax">" Documentation "</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">string</span><span class="plain-syntax">.</span><span class="identifier-syntax">rep</span><span class="plain-syntax">(</span><span class="string-syntax">"-"</span><span class="plain-syntax">, </span><span class="constant-syntax">4</span><span class="plain-syntax">)</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">else</span>
<span class="plain-syntax">                </span><span class="identifier-syntax">error</span><span class="plain-syntax">(</span><span class="string-syntax">"Only two top-level headings allowed in Inform 7 extensions (it should be used for the extension title and, optionally, the documentation header)."</span><span class="plain-syntax">)</span>
<span class="plain-syntax">            </span><span class="identifier-syntax">end</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">end</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">end</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">levels</span><span class="plain-syntax">[</span><span class="identifier-syntax">h</span><span class="plain-syntax">.</span><span class="identifier-syntax">level</span><span class="plain-syntax"> - </span><span class="constant-syntax">1</span><span class="plain-syntax">] .. </span><span class="string-syntax">" - "</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inlines</span><span class="plain-syntax">(</span><span class="identifier-syntax">h</span><span class="plain-syntax">.</span><span class="identifier-syntax">content</span><span class="plain-syntax">)</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">indent_level</span><span class="plain-syntax"> = </span><span class="constant-syntax">0</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Block</span><span class="plain-syntax">.</span><span class="identifier-syntax">BulletList</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">bl</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">local</span><span class="plain-syntax"> </span><span class="identifier-syntax">result</span><span class="plain-syntax"> = </span><span class="string-syntax">""</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">indent_level</span><span class="plain-syntax"> = </span><span class="identifier-syntax">indent_level</span><span class="plain-syntax"> + </span><span class="constant-syntax">1</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">for</span><span class="plain-syntax"> </span><span class="identifier-syntax">i</span><span class="plain-syntax">, </span><span class="identifier-syntax">item</span><span class="plain-syntax"> </span><span class="identifier-syntax">in</span><span class="plain-syntax"> </span><span class="identifier-syntax">ipairs</span><span class="plain-syntax">(</span><span class="identifier-syntax">bl</span><span class="plain-syntax">.</span><span class="identifier-syntax">content</span><span class="plain-syntax">) </span><span class="identifier-syntax">do</span>
<span class="plain-syntax">        </span><span class="identifier-syntax">result</span><span class="plain-syntax"> = </span><span class="identifier-syntax">result</span><span class="plain-syntax"> .. </span><span class="identifier-syntax">string</span><span class="plain-syntax">.</span><span class="identifier-syntax">rep</span><span class="plain-syntax">(</span><span class="string-syntax">"\t"</span><span class="plain-syntax">, </span><span class="identifier-syntax">indent_level</span><span class="plain-syntax">) .. </span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Blocks</span><span class="plain-syntax">(</span><span class="identifier-syntax">item</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">end</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">indent_level</span><span class="plain-syntax"> = </span><span class="identifier-syntax">indent_level</span><span class="plain-syntax"> - </span><span class="constant-syntax">1</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">result</span><span class="plain-syntax"> .. </span><span class="string-syntax">"\n"</span>
<span class="identifier-syntax">end</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Block</span><span class="plain-syntax">.</span><span class="identifier-syntax">OrderedList</span><span class="plain-syntax"> = </span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Block</span><span class="plain-syntax">.</span><span class="identifier-syntax">BulletList</span>

<span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Block</span><span class="plain-syntax">.</span><span class="identifier-syntax">Plain</span><span class="plain-syntax"> = </span><span class="identifier-syntax">function</span><span class="plain-syntax">(</span><span class="identifier-syntax">p</span><span class="plain-syntax">)</span>
<span class="plain-syntax">    </span><span class="identifier-syntax">return</span><span class="plain-syntax"> </span><span class="identifier-syntax">Writer</span><span class="plain-syntax">.</span><span class="identifier-syntax">Inlines</span><span class="plain-syntax">(</span><span class="identifier-syntax">p</span><span class="plain-syntax">.</span><span class="identifier-syntax">content</span><span class="plain-syntax">)</span>
<span class="identifier-syntax">end</span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprevoff">&#10094;</li><li class="progresscurrent">wrtr</li><li class="progresssection"><a href="rdr.html">rdr</a></li><li class="progressnext"><a href="rdr.html">&#10095;</a></li></ul></div>
</nav><!-- End of weave -->

		</main>
	</body>
</html>

